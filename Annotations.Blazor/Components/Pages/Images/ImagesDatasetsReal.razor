@page "/images/datasets"
@using Microsoft.AspNetCore.Authentication

@inject IHttpClientFactory ClientFactory
@inject IHttpContextAccessor httpContextAccessor

@foreach (var name in datasets)
{
    int huh = name;
    <p>@huh</p>
}




@code{
    public List<int>? datasets = new List<int>();
    private bool error = false;
    protected override async Task OnInitializedAsync()
    {
        var httpContext = httpContextAccessor.HttpContext ?? throw new InvalidOperationException("No HttpContext available");

        var accessToken = await httpContext.GetTokenAsync("access_token") ?? throw new InvalidOperationException("No access_token was saved");

        var client = ClientFactory.CreateClient();
        client.BaseAddress = new("https://localhost:7250");

        using var requestMessage = new HttpRequestMessage(HttpMethod.Get, $"/images/datasets");
        requestMessage.Headers.Authorization = new("Bearer", accessToken);

        using var response = await client.SendAsync(requestMessage);
        try
        {
            var something= await response.Content.ReadFromJsonAsync<int[]>();
            for (int i = 0; i < something.Length; i++)
            {
                datasets.Add(something[i]);
            }
        }
        catch (Exception e)
        {
            Console.WriteLine("Status code: " + response.StatusCode);
            error = true;
        }

    }
}