@page "/images/{imageid}"
@using global::Annotations.Core.Models
@using Microsoft.AspNetCore.Authentication
@inject IHttpClientFactory ClientFactory
@inject IHttpContextAccessor httpContextAccessor


<ul>
   
    <li>@story</li>
    
</ul>
@code{

    private byte[]? story;

    protected override async Task OnInitializedAsync()
    {
        var httpContext = httpContextAccessor.HttpContext ?? throw new InvalidOperationException("No HttpContext available");

        var accessToken = await httpContext.GetTokenAsync("access_token") ?? throw new InvalidOperationException("No access_token was saved");

        var client = ClientFactory.CreateClient();
        client.BaseAddress = new("https://localhost:7250");

        using var requestMessage = new HttpRequestMessage(HttpMethod.Get, "/images/0");
        requestMessage.Headers.Authorization = new("Bearer", accessToken);

        using var response = await client.SendAsync(requestMessage);
        var jsonString = await response.Content.ReadAsStringAsync();
        var personObject = System.Text.Json.JsonSerializer.Deserialize<ImageModel>(jsonString);
        story = personObject.ImageData;
    }

}